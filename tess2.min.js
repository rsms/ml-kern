!function(E){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=E();else if("function"==typeof define&&define.amd)define([],E);else{var A;"undefined"!=typeof window?A=window:"undefined"!=typeof global?A=global:"undefined"!=typeof self&&(A=self),A.Tess2=E()}}(function(){var E,A,K;return function F(x,y,p){function l(r,G){if(!y[r]){if(!x[r]){var j=typeof require=="function"&&require;if(!G&&j)return j(r,!0);if(v)return v(r,!0);var B=new Error("Cannot find module '"+r+"'");throw B.code="MODULE_NOT_FOUND",B}var z=y[r]={exports:{}};x[r][0].call(z.exports,function(C){var D=x[r][1][C];return l(D?D:C)},z,z.exports,F,x,y,p)}return y[r].exports}for(var v=typeof require=="function"&&require,w=0;w<p.length;w++)l(p[w]);return l}({1:[function(F,x,y){x.exports=F("./src/tess2")},{"./src/tess2":2}],2:[function(F,x,y){"use strict";var p={};x.exports=p,p.WINDING_ODD=0,p.WINDING_NONZERO=1,p.WINDING_POSITIVE=2,p.WINDING_NEGATIVE=3,p.WINDING_ABS_GEQ_TWO=4,p.POLYGONS=0,p.CONNECTED_POLYGONS=1,p.BOUNDARY_CONTOURS=2,p.tesselate=function(a){for(var b=a.debug||!1,c=new J(),d=0;d<a.contours.length;d++)c.addContour(a.vertexSize||2,a.contours[d]);return c.tesselate(a.windingRule||p.WINDING_ODD,a.elementType||p.POLYGONS,a.polySize||3,a.vertexSize||2,a.normal||[0,0,1]),{vertices:c.vertices,vertexIndices:c.vertexIndices,vertexCount:c.vertexCount,elements:c.elements,elementCount:c.elementCount,mesh:b?c.mesh:void 0}};var l=function(a){if(!a)throw"Assertion Failed!"};function v(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function w(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function r(a){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=a}r.prototype={get Rface(){return this.Sym.Lface},set Rface(a){this.Sym.Lface=a},get Dst(){return this.Sym.Org},set Dst(a){this.Sym.Org=a},get Oprev(){return this.Sym.Lnext},set Oprev(a){this.Sym.Lnext=a},get Lprev(){return this.Onext.Sym},set Lprev(a){this.Onext.Sym=a},get Dprev(){return this.Lnext.Sym},set Dprev(a){this.Lnext.Sym=a},get Rprev(){return this.Sym.Onext},set Rprev(a){this.Sym.Onext=a},get Dnext(){return this.Sym.Onext.Sym},set Dnext(a){this.Sym.Onext.Sym=a},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(a){this.Sym.Lnext.Sym=a}};function G(){var a=new v(),b=new w(),c=new r(0),d=new r(1);a.next=a.prev=a,a.anEdge=null,b.next=b.prev=b,b.anEdge=null,b.trail=null,b.marked=!1,b.inside=!1,c.next=c,c.Sym=d,c.Onext=null,c.Lnext=null,c.Org=null,c.Lface=null,c.winding=0,c.activeRegion=null,d.next=d,d.Sym=c,d.Onext=null,d.Lnext=null,d.Org=null,d.Lface=null,d.winding=0,d.activeRegion=null,this.vHead=a,this.fHead=b,this.eHead=c,this.eHeadSym=d}G.prototype={makeEdge_:function(a){var b=new r(0),c=new r(1);a.Sym.side<a.side&&(a=a.Sym);var d=a.Sym.next;return c.next=d,d.Sym.next=b,b.next=a,a.Sym.next=c,b.Sym=c,b.Onext=b,b.Lnext=c,b.Org=null,b.Lface=null,b.winding=0,b.activeRegion=null,c.Sym=b,c.Onext=c,c.Lnext=b,c.Org=null,c.Lface=null,c.winding=0,c.activeRegion=null,b},splice_:function(a,b){var c=a.Onext,d=b.Onext;c.Sym.Lnext=b,d.Sym.Lnext=a,a.Onext=d,b.Onext=c},makeVertex_:function(a,b,c){var d=a;l(d!==null);var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b;var f=b;do f.Org=d,f=f.Onext;while(f!==b)},makeFace_:function(a,b,c){var d=a;l(d!==null);var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b,d.trail=null,d.marked=!1,d.inside=c.inside;var f=b;do f.Lface=d,f=f.Lnext;while(f!==b)},killEdge_:function(a){a.Sym.side<a.side&&(a=a.Sym);var b=a.next,c=a.Sym.next;b.Sym.next=c,c.Sym.next=b},killVertex_:function(a,b){var c=a.anEdge,d=c;do d.Org=b,d=d.Onext;while(d!==c);var e=a.prev,f=a.next;f.prev=e,e.next=f},killFace_:function(a,b){var c=a.anEdge,d=c;do d.Lface=b,d=d.Lnext;while(d!==c);var e=a.prev,f=a.next;f.prev=e,e.next=f},makeEdge:function(){var a=new v(),b=new v(),c=new w(),d=this.makeEdge_(this.eHead);return this.makeVertex_(a,d,this.vHead),this.makeVertex_(b,d.Sym,this.vHead),this.makeFace_(c,d,this.fHead),d},splice:function(a,b){var c=!1,d=!1;if(a===b)return;b.Org!==a.Org&&(d=!0,this.killVertex_(b.Org,a.Org)),b.Lface!==a.Lface&&(c=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(b,a);if(!d){var e=new v();this.makeVertex_(e,b,a.Org),a.Org.anEdge=a}if(!c){var f=new w();this.makeFace_(f,b,a.Lface),a.Lface.anEdge=a}},delete:function(a){var b=a.Sym,c=!1;a.Lface!==a.Rface&&(c=!0,this.killFace_(a.Lface,a.Rface));if(a.Onext===a)this.killVertex_(a.Org,null);else{a.Rface.anEdge=a.Oprev,a.Org.anEdge=a.Onext,this.splice_(a,a.Oprev);if(!c){var d=new w();this.makeFace_(d,a,a.Lface)}}b.Onext===b?(this.killVertex_(b.Org,null),this.killFace_(b.Lface,null)):(a.Lface.anEdge=b.Oprev,b.Org.anEdge=b.Onext,this.splice_(b,b.Oprev)),this.killEdge_(a)},addEdgeVertex:function(a){var b=this.makeEdge_(a),c=b.Sym;this.splice_(b,a.Lnext),b.Org=a.Dst;var d=new v();return this.makeVertex_(d,c,b.Org),b.Lface=c.Lface=a.Lface,b},splitEdge:function(a,b){var c=this.addEdgeVertex(a),d=c.Sym;return this.splice_(a.Sym,a.Sym.Oprev),this.splice_(a.Sym,d),a.Dst=d.Org,d.Dst.anEdge=d.Sym,d.Rface=a.Rface,d.winding=a.winding,d.Sym.winding=a.Sym.winding,d},connect:function(a,b){var c=!1,d=this.makeEdge_(a),e=d.Sym;b.Lface!==a.Lface&&(c=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(d,a.Lnext),this.splice_(e,b),d.Org=a.Dst,e.Org=b.Org,d.Lface=e.Lface=a.Lface,a.Lface.anEdge=e;if(!c){var f=new w();this.makeFace_(f,d,a.Lface)}return d},zapFace:function(a){var b=a.anEdge,c,d,e,f,i;d=b.Lnext;do c=d,d=c.Lnext,c.Lface=null,c.Rface===null&&(c.Onext===c?this.killVertex_(c.Org,null):(c.Org.anEdge=c.Onext,this.splice_(c,c.Oprev)),e=c.Sym,e.Onext===e?this.killVertex_(e.Org,null):(e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),this.killEdge_(c));while(c!=b);f=a.prev,i=a.next,i.prev=f,f.next=i},countFaceVerts_:function(a){var b=a.anEdge,c=0;do c++,b=b.Lnext;while(b!==a.anEdge);return c},mergeConvexFaces:function(a){var b,c,d,e,f,i,g;for(b=this.fHead.next;b!==this.fHead;b=b.next){if(!b.inside)continue;for(c=b.anEdge,f=c.Org;;){d=c.Lnext,e=c.Sym,e&&e.Lface&&e.Lface.inside&&(i=this.countFaceVerts_(b),g=this.countFaceVerts_(e.Lface),i+g-2<=a&&(j.vertCCW(c.Lprev.Org,c.Org,e.Lnext.Lnext.Org)&&j.vertCCW(e.Lprev.Org,e.Org,c.Lnext.Lnext.Org)&&(d=e.Lnext,this.delete(e),c=null,e=null)));if(c&&c.Lnext.Org===f)break;c=d}}return!0},check:function(){var a=this.fHead,b=this.vHead,c=this.eHead,d,e,f,i,g,k;for(e=a,e=a;(d=e.next)!==a;e=d){l(d.prev===e),g=d.anEdge;do l(g.Sym!==g),l(g.Sym.Sym===g),l(g.Lnext.Onext.Sym===g),l(g.Onext.Sym.Lnext===g),l(g.Lface===d),g=g.Lnext;while(g!==d.anEdge)}for(l(d.prev===e&&d.anEdge===null),i=b,i=b;(f=i.next)!==b;i=f){l(f.prev===i),g=f.anEdge;do l(g.Sym!==g),l(g.Sym.Sym===g),l(g.Lnext.Onext.Sym===g),l(g.Onext.Sym.Lnext===g),l(g.Org===f),g=g.Onext;while(g!==f.anEdge)}for(l(f.prev===i&&f.anEdge===null),k=c,k=c;(g=k.next)!==c;k=g)l(g.Sym.next===k.Sym),l(g.Sym!==g),l(g.Sym.Sym===g),l(g.Org!==null),l(g.Dst!==null),l(g.Lnext.Onext.Sym===g),l(g.Onext.Sym.Lnext===g);l(g.Sym.next===k.Sym&&g.Sym===this.eHeadSym&&g.Sym.Sym===g&&g.Org===null&&g.Dst===null&&g.Lface===null&&g.Rface===null)}};var j={};j.vertEq=function(a,b){return a.s===b.s&&a.t===b.t},j.vertLeq=function(a,b){return a.s<b.s||a.s===b.s&&a.t<=b.t},j.transLeq=function(a,b){return a.t<b.t||a.t===b.t&&a.s<=b.s},j.edgeGoesLeft=function(a){return j.vertLeq(a.Dst,a.Org)},j.edgeGoesRight=function(a){return j.vertLeq(a.Org,a.Dst)},j.vertL1dist=function(a,b){return Math.abs(a.s-b.s)+Math.abs(a.t-b.t)},j.edgeEval=function(a,b,c){l(j.vertLeq(a,b)&&j.vertLeq(b,c));var d=b.s-a.s,e=c.s-b.s;return d+e>0?d<e?b.t-a.t+(a.t-c.t)*(d/(d+e)):b.t-c.t+(c.t-a.t)*(e/(d+e)):0},j.edgeSign=function(a,b,c){l(j.vertLeq(a,b)&&j.vertLeq(b,c));var d=b.s-a.s,e=c.s-b.s;return d+e>0?(b.t-c.t)*d+(b.t-a.t)*e:0},j.transEval=function(a,b,c){l(j.transLeq(a,b)&&j.transLeq(b,c));var d=b.t-a.t,e=c.t-b.t;return d+e>0?d<e?b.s-a.s+(a.s-c.s)*(d/(d+e)):b.s-c.s+(c.s-a.s)*(e/(d+e)):0},j.transSign=function(a,b,c){l(j.transLeq(a,b)&&j.transLeq(b,c));var d=b.t-a.t,e=c.t-b.t;return d+e>0?(b.s-c.s)*d+(b.s-a.s)*e:0},j.vertCCW=function(a,b,c){return a.s*(b.t-c.t)+b.s*(c.t-a.t)+c.s*(a.t-b.t)>=0},j.interpolate=function(a,b,c,d){return a=a<0?0:a,c=c<0?0:c,a<=c?c==0?(b+d)/2:b+(d-b)*(a/(a+c)):d+(b-d)*(c/(a+c))},j.intersect=function(a,b,c,d,e){var f,i,g;j.vertLeq(a,b)||(g=a,a=b,b=g),j.vertLeq(c,d)||(g=c,c=d,d=g),j.vertLeq(a,c)||(g=a,a=c,c=g,g=b,b=d,d=g),j.vertLeq(c,b)?j.vertLeq(b,d)?(f=j.edgeEval(a,c,b),i=j.edgeEval(c,b,d),f+i<0&&(f=-f,i=-i),e.s=j.interpolate(f,c.s,i,b.s)):(f=j.edgeSign(a,c,b),i=-j.edgeSign(a,d,b),f+i<0&&(f=-f,i=-i),e.s=j.interpolate(f,c.s,i,d.s)):e.s=(c.s+b.s)/2,j.transLeq(a,b)||(g=a,a=b,b=g),j.transLeq(c,d)||(g=c,c=d,d=g),j.transLeq(a,c)||(g=a,a=c,c=g,g=b,b=d,d=g),j.transLeq(c,b)?j.transLeq(b,d)?(f=j.transEval(a,c,b),i=j.transEval(c,b,d),f+i<0&&(f=-f,i=-i),e.t=j.interpolate(f,c.t,i,b.t)):(f=j.transSign(a,c,b),i=-j.transSign(a,d,b),f+i<0&&(f=-f,i=-i),e.t=j.interpolate(f,c.t,i,d.t)):e.t=(c.t+b.t)/2};function B(){this.key=null,this.next=null,this.prev=null}function z(a,b){this.head=new B(),this.head.next=this.head,this.head.prev=this.head,this.frame=a,this.leq=b}z.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(a){return this.insertBefore(this.head,a)},search:function(a){var b=this.head;do b=b.next;while(b.key!==null&&!this.leq(this.frame,a,b.key));return b},insertBefore:function(a,b){do a=a.prev;while(a.key!==null&&!this.leq(this.frame,a.key,b));var c=new B();return c.key=b,c.next=a.next,a.next.prev=c,c.prev=a,a.next=c,c},delete:function(a){a.next.prev=a.prev,a.prev.next=a.next}};function C(){this.handle=null}function D(){this.key=null,this.node=null}function I(a,b){this.size=0,this.max=a,this.nodes=[],this.nodes.length=a+1;for(var c=0;c<this.nodes.length;c++)this.nodes[c]=new C();this.handles=[],this.handles.length=a+1;for(var c=0;c<this.handles.length;c++)this.handles[c]=new D();this.initialized=!1,this.freeList=0,this.leq=b,this.nodes[1].handle=1,this.handles[1].key=null}I.prototype={floatDown_:function(a){var b=this.nodes,c=this.handles,d,e,f;for(d=b[a].handle;;){f=a<<1,f<this.size&&this.leq(c[b[f+1].handle].key,c[b[f].handle].key)&&++f,l(f<=this.max),e=b[f].handle;if(f>this.size||this.leq(c[d].key,c[e].key)){b[a].handle=d,c[d].node=a;break}b[a].handle=e,c[e].node=a,a=f}},floatUp_:function(a){var b=this.nodes,c=this.handles,d,e,f;for(d=b[a].handle;;){f=a>>1,e=b[f].handle;if(f==0||this.leq(c[e].key,c[d].key)){b[a].handle=d,c[d].node=a;break}b[a].handle=e,c[e].node=a,a=f}},init:function(){for(var a=this.size;a>=1;--a)this.floatDown_(a);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){this.size===0},insert:function(a){var b,c;b=++this.size;if(b*2>this.max){this.max*=2;var d;d=this.nodes.length,this.nodes.length=this.max+1;for(var e=d;e<this.nodes.length;e++)this.nodes[e]=new C();d=this.handles.length,this.handles.length=this.max+1;for(var e=d;e<this.handles.length;e++)this.handles[e]=new D()}return this.freeList===0?c=b:(c=this.freeList,this.freeList=this.handles[c].node),this.nodes[b].handle=c,this.handles[c].node=b,this.handles[c].key=a,this.initialized&&this.floatUp_(b),c},extractMin:function(){var a=this.nodes,b=this.handles,c=a[1].handle,d=b[c].key;return this.size>0&&(a[1].handle=a[this.size].handle,b[a[1].handle].node=1,b[c].key=null,b[c].node=this.freeList,this.freeList=c,--this.size,this.size>0&&this.floatDown_(1)),d},delete:function(a){var b=this.nodes,c=this.handles,d;l(a>=1&&a<=this.max&&c[a].key!==null),d=c[a].node,b[d].handle=b[this.size].handle,c[b[d].handle].node=d,--this.size,d<=this.size&&(d<=1||this.leq(c[b[d>>1].handle].key,c[b[d].handle].key)?this.floatDown_(d):this.floatUp_(d)),c[a].key=null,c[a].node=this.freeList,this.freeList=a}};function H(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}var h={};h.regionBelow=function(a){return a.nodeUp.prev.key},h.regionAbove=function(a){return a.nodeUp.next.key},h.debugEvent=function(a){},h.addWinding=function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},h.edgeLeq=function(a,b,c){var d=a.event,e,f,i=b.eUp,g=c.eUp;if(i.Dst===d)return g.Dst===d?j.vertLeq(i.Org,g.Org)?j.edgeSign(g.Dst,i.Org,g.Org)<=0:j.edgeSign(i.Dst,g.Org,i.Org)>=0:j.edgeSign(g.Dst,d,g.Org)<=0;if(g.Dst===d)return j.edgeSign(i.Dst,d,i.Org)>=0;var e=j.edgeEval(i.Dst,d,i.Org),f=j.edgeEval(g.Dst,d,g.Org);return e>=f},h.deleteRegion=function(a,b){b.fixUpperEdge&&l(b.eUp.winding===0),b.eUp.activeRegion=null,a.dict.delete(b.nodeUp)},h.fixUpperEdge=function(a,b,c){l(b.fixUpperEdge),a.mesh.delete(b.eUp),b.fixUpperEdge=!1,b.eUp=c,c.activeRegion=b},h.topLeftRegion=function(a,b){var c=b.eUp.Org,d;do b=h.regionAbove(b);while(b.eUp.Org===c);if(b.fixUpperEdge){d=a.mesh.connect(h.regionBelow(b).eUp.Sym,b.eUp.Lnext);if(d===null)return null;h.fixUpperEdge(a,b,d),b=h.regionAbove(b)}return b},h.topRightRegion=function(a){var b=a.eUp.Dst,a=null;do a=h.regionAbove(a);while(a.eUp.Dst===b);return a},h.addRegionBelow=function(a,b,c){var d=new H();return d.eUp=c,d.nodeUp=a.dict.insertBefore(b.nodeUp,d),d.fixUpperEdge=!1,d.sentinel=!1,d.dirty=!1,c.activeRegion=d,d},h.isWindingInside=function(a,b){switch(a.windingRule){case p.WINDING_ODD:return(b&1)!=0;case p.WINDING_NONZERO:return b!=0;case p.WINDING_POSITIVE:return b>0;case p.WINDING_NEGATIVE:return b<0;case p.WINDING_ABS_GEQ_TWO:return b>=2||b<=-2}return l(!1),!1},h.computeWinding=function(a,b){b.windingNumber=h.regionAbove(b).windingNumber+b.eUp.winding,b.inside=h.isWindingInside(a,b.windingNumber)},h.finishRegion=function(a,b){var c=b.eUp,d=c.Lface;d.inside=b.inside,d.anEdge=c,h.deleteRegion(a,b)},h.finishLeftRegions=function(a,b,c){for(var d,e,f=null,i=b,e=b.eUp;i!==c;){i.fixUpperEdge=!1,f=h.regionBelow(i),d=f.eUp;if(d.Org!=e.Org){if(!f.fixUpperEdge){h.finishRegion(a,i);break}d=a.mesh.connect(e.Lprev,d.Sym),h.fixUpperEdge(a,f,d)}e.Onext!==d&&(a.mesh.splice(d.Oprev,d),a.mesh.splice(e,d)),h.finishRegion(a,i),e=f.eUp,i=f}return e},h.addRightEdges=function(a,b,c,d,e,f){var i,g,k,m,q=!0;k=c;do l(j.vertLeq(k.Org,k.Dst)),h.addRegionBelow(a,b,k.Sym),k=k.Onext;while(k!==d);for(e===null&&(e=h.regionBelow(b).eUp.Rprev),g=b,m=e;;){i=h.regionBelow(g),k=i.eUp.Sym;if(k.Org!==m.Org)break;k.Onext!==m&&(a.mesh.splice(k.Oprev,k),a.mesh.splice(m.Oprev,k)),i.windingNumber=g.windingNumber-k.winding,i.inside=h.isWindingInside(a,i.windingNumber),g.dirty=!0,!q&&h.checkForRightSplice(a,g)&&(h.addWinding(k,m),h.deleteRegion(a,g),a.mesh.delete(m)),q=!1,g=i,m=k}g.dirty=!0,l(g.windingNumber-k.winding===i.windingNumber),f&&h.walkDirtyRegions(a,g)},h.spliceMergeVertices=function(a,b,c){a.mesh.splice(b,c)},h.vertexWeights=function(a,b,c){var d=j.vertL1dist(b,a),e=j.vertL1dist(c,a),f=.5*e/(d+e),i=.5*d/(d+e);a.coords[0]+=f*b.coords[0]+i*c.coords[0],a.coords[1]+=f*b.coords[1]+i*c.coords[1],a.coords[2]+=f*b.coords[2]+i*c.coords[2]},h.getIntersectData=function(a,b,c,d,e,f){b.coords[0]=b.coords[1]=b.coords[2]=0,b.idx=-1,h.vertexWeights(b,c,d),h.vertexWeights(b,e,f)},h.checkForRightSplice=function(a,b){var c=h.regionBelow(b),d=b.eUp,e=c.eUp;if(j.vertLeq(d.Org,e.Org)){if(j.edgeSign(e.Dst,d.Org,e.Org)>0)return!1;j.vertEq(d.Org,e.Org)?d.Org!==e.Org&&(a.pq.delete(d.Org.pqHandle),h.spliceMergeVertices(a,e.Oprev,d)):(a.mesh.splitEdge(e.Sym),a.mesh.splice(d,e.Oprev),b.dirty=c.dirty=!0)}else{if(j.edgeSign(d.Dst,e.Org,d.Org)<0)return!1;h.regionAbove(b).dirty=b.dirty=!0,a.mesh.splitEdge(d.Sym),a.mesh.splice(e.Oprev,d)}return!0},h.checkForLeftSplice=function(a,b){var c=h.regionBelow(b),d=b.eUp,e=c.eUp,f;l(!j.vertEq(d.Dst,e.Dst));if(j.vertLeq(d.Dst,e.Dst)){if(j.edgeSign(d.Dst,e.Dst,d.Org)<0)return!1;h.regionAbove(b).dirty=b.dirty=!0,f=a.mesh.splitEdge(d),a.mesh.splice(e.Sym,f),f.Lface.inside=b.inside}else{if(j.edgeSign(e.Dst,d.Dst,e.Org)>0)return!1;b.dirty=c.dirty=!0,f=a.mesh.splitEdge(e),a.mesh.splice(d.Lnext,e.Sym),f.Rface.inside=b.inside}return!0},h.checkForIntersect=function(a,b){var c=h.regionBelow(b),d=b.eUp,e=c.eUp,f=d.Org,i=e.Org,g=d.Dst,k=e.Dst,m,q,n=new v(),s,t;l(!j.vertEq(k,g)),l(j.edgeSign(g,a.event,f)<=0),l(j.edgeSign(k,a.event,i)>=0),l(f!==a.event&&i!==a.event),l(!b.fixUpperEdge&&!c.fixUpperEdge);if(f===i)return!1;m=Math.min(f.t,g.t),q=Math.max(i.t,k.t);if(m>q)return!1;if(j.vertLeq(f,i)){if(j.edgeSign(k,f,i)>0)return!1}else if(j.edgeSign(g,i,f)<0)return!1;return h.debugEvent(a),j.intersect(g,f,k,i,n),l(Math.min(f.t,g.t)<=n.t),l(n.t<=Math.max(i.t,k.t)),l(Math.min(k.s,g.s)<=n.s),l(n.s<=Math.max(i.s,f.s)),j.vertLeq(n,a.event)&&(n.s=a.event.s,n.t=a.event.t),s=j.vertLeq(f,i)?f:i,j.vertLeq(s,n)&&(n.s=s.s,n.t=s.t),j.vertEq(n,f)||j.vertEq(n,i)?(h.checkForRightSplice(a,b),!1):!j.vertEq(g,a.event)&&j.edgeSign(g,a.event,n)>=0||!j.vertEq(k,a.event)&&j.edgeSign(k,a.event,n)<=0?k===a.event?(a.mesh.splitEdge(d.Sym),a.mesh.splice(e.Sym,d),b=h.topLeftRegion(a,b),d=h.regionBelow(b).eUp,h.finishLeftRegions(a,h.regionBelow(b),c),h.addRightEdges(a,b,d.Oprev,d,d,!0),TRUE):g===a.event?(a.mesh.splitEdge(e.Sym),a.mesh.splice(d.Lnext,e.Oprev),c=b,b=h.topRightRegion(b),t=h.regionBelow(b).eUp.Rprev,c.eUp=e.Oprev,e=h.finishLeftRegions(a,c,null),h.addRightEdges(a,b,e.Onext,d.Rprev,t,!0),!0):(j.edgeSign(g,a.event,n)>=0&&(h.regionAbove(b).dirty=b.dirty=!0,a.mesh.splitEdge(d.Sym),d.Org.s=a.event.s,d.Org.t=a.event.t),j.edgeSign(k,a.event,n)<=0&&(b.dirty=c.dirty=!0,a.mesh.splitEdge(e.Sym),e.Org.s=a.event.s,e.Org.t=a.event.t),!1):(a.mesh.splitEdge(d.Sym),a.mesh.splitEdge(e.Sym),a.mesh.splice(e.Oprev,d),d.Org.s=n.s,d.Org.t=n.t,d.Org.pqHandle=a.pq.insert(d.Org),h.getIntersectData(a,d.Org,f,g,i,k),h.regionAbove(b).dirty=b.dirty=c.dirty=!0,!1)},h.walkDirtyRegions=function(a,b){for(var c=h.regionBelow(b),d,e;;){for(;c.dirty;)b=c,c=h.regionBelow(c);if(!b.dirty){c=b,b=h.regionAbove(b);if(b==null||!b.dirty)return}b.dirty=!1,d=b.eUp,e=c.eUp,d.Dst!==e.Dst&&(h.checkForLeftSplice(a,b)&&(c.fixUpperEdge?(h.deleteRegion(a,c),a.mesh.delete(e),c=h.regionBelow(b),e=c.eUp):b.fixUpperEdge&&(h.deleteRegion(a,b),a.mesh.delete(d),b=h.regionAbove(c),d=b.eUp)));if(d.Org!==e.Org)if(d.Dst!==e.Dst&&!b.fixUpperEdge&&!c.fixUpperEdge&&(d.Dst===a.event||e.Dst===a.event)){if(h.checkForIntersect(a,b))return}else h.checkForRightSplice(a,b);d.Org===e.Org&&d.Dst===e.Dst&&(h.addWinding(e,d),h.deleteRegion(a,b),a.mesh.delete(d),b=h.regionAbove(c))}},h.connectRightVertex=function(a,b,c){var d,e=c.Onext,f=h.regionBelow(b),i=b.eUp,g=f.eUp,k=!1;i.Dst!==g.Dst&&h.checkForIntersect(a,b),j.vertEq(i.Org,a.event)&&(a.mesh.splice(e.Oprev,i),b=h.topLeftRegion(a,b),e=h.regionBelow(b).eUp,h.finishLeftRegions(a,h.regionBelow(b),f),k=!0),j.vertEq(g.Org,a.event)&&(a.mesh.splice(c,g.Oprev),c=h.finishLeftRegions(a,f,null),k=!0);if(k){h.addRightEdges(a,b,c.Onext,e,e,!0);return}j.vertLeq(g.Org,i.Org)?d=g.Oprev:d=i,d=a.mesh.connect(c.Lprev,d),h.addRightEdges(a,b,d,d.Onext,d.Onext,!1),d.Sym.activeRegion.fixUpperEdge=!0,h.walkDirtyRegions(a,b)},h.connectLeftDegenerate=function(a,b,c){var d,e,f,i,g;d=b.eUp;if(j.vertEq(d.Org,c)){l(!1),h.spliceMergeVertices(a,d,c.anEdge);return}if(!j.vertEq(d.Dst,c)){a.mesh.splitEdge(d.Sym),b.fixUpperEdge&&(a.mesh.delete(d.Onext),b.fixUpperEdge=!1),a.mesh.splice(c.anEdge,d),h.sweepEvent(a,c);return}l(!1),b=h.topRightRegion(b),g=h.regionBelow(b),f=g.eUp.Sym,e=i=f.Onext,g.fixUpperEdge&&(l(e!==f),h.deleteRegion(a,g),a.mesh.delete(f),f=e.Oprev),a.mesh.splice(c.anEdge,f),j.edgeGoesLeft(e)||(e=null),h.addRightEdges(a,b,f.Onext,i,e,!0)},h.connectLeftVertex=function(a,b){var c,d,e,f,i,g,k=new H();k.eUp=b.anEdge.Sym,c=a.dict.search(k).key,d=h.regionBelow(c);if(!d)return;f=c.eUp,i=d.eUp;if(j.edgeSign(f.Dst,b,f.Org)===0){h.connectLeftDegenerate(a,c,b);return}e=j.vertLeq(i.Dst,f.Dst)?c:d;if(c.inside||e.fixUpperEdge){if(e===c)g=a.mesh.connect(b.anEdge.Sym,f.Lnext);else{var m=a.mesh.connect(i.Dnext,b.anEdge);g=m.Sym}e.fixUpperEdge?h.fixUpperEdge(a,e,g):h.computeWinding(a,h.addRegionBelow(a,c,g)),h.sweepEvent(a,b)}else h.addRightEdges(a,c,b.anEdge,b.anEdge,null,!0)},h.sweepEvent=function(a,b){a.event=b,h.debugEvent(a);for(var c=b.anEdge;c.activeRegion===null;){c=c.Onext;if(c==b.anEdge){h.connectLeftVertex(a,b);return}}var d=h.topLeftRegion(a,c.activeRegion);l(d!==null);var e=h.regionBelow(d),f=e.eUp,i=h.finishLeftRegions(a,e,null);i.Onext===f?h.connectRightVertex(a,d,i):h.addRightEdges(a,d,i.Onext,f,f,!0)},h.addSentinel=function(a,b,c,d){var e=new H(),f=a.mesh.makeEdge();f.Org.s=c,f.Org.t=d,f.Dst.s=b,f.Dst.t=d,a.event=f.Dst,e.eUp=f,e.windingNumber=0,e.inside=!1,e.fixUpperEdge=!1,e.sentinel=!0,e.dirty=!1,e.nodeUp=a.dict.insert(e)},h.initEdgeDict=function(a){a.dict=new z(a,h.edgeLeq);var b=a.bmax[0]-a.bmin[0],c=a.bmax[1]-a.bmin[1],d=a.bmin[0]-b,e=a.bmax[0]+b,f=a.bmin[1]-c,i=a.bmax[1]+c;h.addSentinel(a,d,e,f),h.addSentinel(a,d,e,i)},h.doneEdgeDict=function(a){for(var b,c=0;(b=a.dict.min().key)!==null;)b.sentinel||(l(b.fixUpperEdge),l(++c==1)),l(b.windingNumber==0),h.deleteRegion(a,b)},h.removeDegenerateEdges=function(a){var b,c,d,e=a.mesh.eHead;for(b=e.next;b!==e;b=c)c=b.next,d=b.Lnext,j.vertEq(b.Org,b.Dst)&&b.Lnext.Lnext!==b&&(h.spliceMergeVertices(a,d,b),a.mesh.delete(b),b=d,d=b.Lnext),d.Lnext===b&&(d!==b&&((d===c||d===c.Sym)&&(c=c.next),a.mesh.delete(d)),(b===c||b===c.Sym)&&(c=c.next),a.mesh.delete(b))},h.initPriorityQ=function(a){var b,c,d,e=0;for(d=a.mesh.vHead,c=d.next;c!==d;c=c.next)e++;for(e+=8,b=a.pq=new I(e,j.vertLeq),d=a.mesh.vHead,c=d.next;c!==d;c=c.next)c.pqHandle=b.insert(c);return c!==d?!1:(b.init(),!0)},h.donePriorityQ=function(a){a.pq=null},h.removeDegenerateFaces=function(a,b){var c,d,e;for(c=b.fHead.next;c!==b.fHead;c=d)d=c.next,e=c.anEdge,l(e.Lnext!==e),e.Lnext.Lnext===e&&(h.addWinding(e.Onext,e),a.mesh.delete(e));return!0},h.computeInterior=function(a){var b,c;h.removeDegenerateEdges(a);if(!h.initPriorityQ(a))return!1;for(h.initEdgeDict(a);(b=a.pq.extractMin())!==null;){for(;;){c=a.pq.min();if(c===null||!j.vertEq(c,b))break;c=a.pq.extractMin(),h.spliceMergeVertices(a,b.anEdge,c.anEdge)}h.sweepEvent(a,b)}return a.event=a.dict.min().key.eUp.Org,h.debugEvent(a),h.doneEdgeDict(a),h.donePriorityQ(a),h.removeDegenerateFaces(a,a.mesh)?(a.mesh.check(),!0):!1};function J(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=p.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}J.prototype={dot_:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},normalize_:function(a){var b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];l(b>0),b=Math.sqrt(b),a[0]/=b,a[1]/=b,a[2]/=b},longAxis_:function(a){var b=0;return Math.abs(a[1])>Math.abs(a[0])&&(b=1),Math.abs(a[2])>Math.abs(a[b])&&(b=2),b},computeNormal_:function(a){var b,c,d,e,f,i,g=[0,0,0],k=[0,0,0],m=[0,0,0],q=[0,0,0],n=[0,0,0],s=[null,null,null],t=[null,null,null],u=this.mesh.vHead,o;for(b=u.next,o=0;o<3;++o)e=b.coords[o],k[o]=e,t[o]=b,g[o]=e,s[o]=b;for(b=u.next;b!==u;b=b.next)for(o=0;o<3;++o)e=b.coords[o],e<k[o]&&(k[o]=e,t[o]=b),e>g[o]&&(g[o]=e,s[o]=b);o=0,g[1]-k[1]>g[0]-k[0]&&(o=1),g[2]-k[2]>g[o]-k[o]&&(o=2);if(k[o]>=g[o]){a[0]=0,a[1]=0,a[2]=1;return}for(i=0,c=t[o],d=s[o],m[0]=c.coords[0]-d.coords[0],m[1]=c.coords[1]-d.coords[1],m[2]=c.coords[2]-d.coords[2],b=u.next;b!==u;b=b.next)q[0]=b.coords[0]-d.coords[0],q[1]=b.coords[1]-d.coords[1],q[2]=b.coords[2]-d.coords[2],n[0]=m[1]*q[2]-m[2]*q[1],n[1]=m[2]*q[0]-m[0]*q[2],n[2]=m[0]*q[1]-m[1]*q[0],f=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],f>i&&(i=f,a[0]=n[0],a[1]=n[1],a[2]=n[2]);i<=0&&(a[0]=a[1]=a[2]=0,a[this.longAxis_(m)]=1)},checkOrientation_:function(){var a,b,c=this.mesh.fHead,d,e=this.mesh.vHead,f;for(a=0,b=c.next;b!==c;b=b.next){f=b.anEdge;if(f.winding<=0)continue;do a+=(f.Org.s-f.Dst.s)*(f.Org.t+f.Dst.t),f=f.Lnext;while(f!==b.anEdge)}if(a<0){for(d=e.next;d!==e;d=d.next)d.t=-d.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var a,b=this.mesh.vHead,c=[0,0,0],d,e,f,i,g=!1;for(c[0]=this.normal[0],c[1]=this.normal[1],c[2]=this.normal[2],c[0]===0&&c[1]===0&&c[2]===0&&(this.computeNormal_(c),g=!0),d=this.sUnit,e=this.tUnit,f=this.longAxis_(c),d[f]=0,d[(f+1)%3]=1,d[(f+2)%3]=0,e[f]=0,e[(f+1)%3]=0,e[(f+2)%3]=c[f]>0?1:-1,a=b.next;a!==b;a=a.next)a.s=this.dot_(a.coords,d),a.t=this.dot_(a.coords,e);for(g&&this.checkOrientation_(),i=!0,a=b.next;a!==b;a=a.next)i?(this.bmin[0]=this.bmax[0]=a.s,this.bmin[1]=this.bmax[1]=a.t,i=!1):(a.s<this.bmin[0]&&(this.bmin[0]=a.s),a.s>this.bmax[0]&&(this.bmax[0]=a.s),a.t<this.bmin[1]&&(this.bmin[1]=a.t),a.t>this.bmax[1]&&(this.bmax[1]=a.t))},addWinding_:function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},tessellateMonoRegion_:function(a,b){var c,d;for(c=b.anEdge,l(c.Lnext!==c&&c.Lnext.Lnext!==c);j.vertLeq(c.Dst,c.Org);c=c.Lprev);for(;j.vertLeq(c.Org,c.Dst);c=c.Lnext);for(d=c.Lprev;c.Lnext!==d;)if(j.vertLeq(c.Dst,d.Org)){for(;d.Lnext!==c&&(j.edgeGoesLeft(d.Lnext)||j.edgeSign(d.Org,d.Dst,d.Lnext.Dst)<=0);){var e=a.connect(d.Lnext,d);d=e.Sym}d=d.Lprev}else{for(;d.Lnext!=c&&(j.edgeGoesRight(c.Lprev)||j.edgeSign(c.Dst,c.Org,c.Lprev.Org)>=0);){var e=a.connect(c,c.Lprev);c=e.Sym}c=c.Lnext}for(l(d.Lnext!==c);d.Lnext.Lnext!==c;){var e=a.connect(d.Lnext,d);d=e.Sym}return!0},tessellateInterior_:function(a){var b,c;for(b=a.fHead.next;b!==a.fHead;b=c){c=b.next;if(b.inside){if(!this.tessellateMonoRegion_(a,b))return!1}}return!0},discardExterior_:function(a){var b,c;for(b=a.fHead.next;b!==a.fHead;b=c)c=b.next,b.inside||a.zapFace(b)},setWindingNumber_:function(a,b,c){var d,e;for(d=a.eHead.next;d!==a.eHead;d=e)e=d.next,d.Rface.inside!==d.Lface.inside?d.winding=d.Lface.inside?b:-b:c?a.delete(d):d.winding=0},getNeighbourFace_:function(a){return a.Rface?a.Rface.inside?a.Rface.n:-1:-1},outputPolymesh_:function(a,b,c,d){var e,f,i,g=0,k=0,m,q,n=0,s;for(c>3&&a.mergeConvexFaces(c),e=a.vHead.next;e!==a.vHead;e=e.next)e.n=-1;for(f=a.fHead.next;f!=a.fHead;f=f.next){f.n=-1;if(!f.inside)continue;i=f.anEdge,m=0;do e=i.Org,e.n===-1&&(e.n=k,k++),m++,i=i.Lnext;while(i!==f.anEdge);l(m<=c),f.n=g,++g}for(this.elementCount=g,b==p.CONNECTED_POLYGONS&&(g*=2),this.elements=[],this.elements.length=g*c,this.vertexCount=k,this.vertices=[],this.vertices.length=k*d,this.vertexIndices=[],this.vertexIndices.length=k,e=a.vHead.next;e!==a.vHead;e=e.next)if(e.n!=-1){var t=e.n*d;this.vertices[t+0]=e.coords[0],this.vertices[t+1]=e.coords[1],d>2&&(this.vertices[t+2]=e.coords[2]),this.vertexIndices[e.n]=e.idx}var u=0;for(f=a.fHead.next;f!==a.fHead;f=f.next){if(!f.inside)continue;i=f.anEdge,m=0;do e=i.Org,this.elements[u++]=e.n,m++,i=i.Lnext;while(i!==f.anEdge);for(q=m;q<c;++q)this.elements[u++]=-1;if(b==p.CONNECTED_POLYGONS){i=f.anEdge;do this.elements[u++]=this.getNeighbourFace_(i),i=i.Lnext;while(i!==f.anEdge);for(q=m;q<c;++q)this.elements[u++]=-1}}},outputContours_:function(a,b){var c,d,e,f,i,g,k=0,m=0;for(this.vertexCount=0,this.elementCount=0,c=a.fHead.next;c!==a.fHead;c=c.next){if(!c.inside)continue;e=d=c.anEdge;do this.vertexCount++,d=d.Lnext;while(d!==e);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*b,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var q=0,n=0,s=0;for(k=0,c=a.fHead.next;c!==a.fHead;c=c.next){if(!c.inside)continue;m=0,e=d=c.anEdge;do this.vertices[q++]=d.Org.coords[0],this.vertices[q++]=d.Org.coords[1],b>2&&(this.vertices[q++]=d.Org.coords[2]),this.vertexIndices[n++]=d.Org.idx,m++,d=d.Lnext;while(d!==e);this.elements[s++]=k,this.elements[s++]=m,k+=m}},addContour:function(a,b){var c,d;for(this.mesh===null&&(this.mesh=new G()),a<2&&(a=2),a>3&&(a=3),c=null,d=0;d<b.length;d+=a)c==null?(c=this.mesh.makeEdge(),this.mesh.splice(c,c.Sym)):(this.mesh.splitEdge(c),c=c.Lnext),c.Org.coords[0]=b[d+0],c.Org.coords[1]=b[d+1],a>2?c.Org.coords[2]=b[d+2]:c.Org.coords[2]=0,c.Org.idx=this.vertexIndexCounter++,c.winding=1,c.Sym.winding=-1},tesselate:function(a,b,c,d,e){this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,e&&(this.normal[0]=e[0],this.normal[1]=e[1],this.normal[2]=e[2]),this.windingRule=a,d<2&&(d=2),d>3&&(d=3);if(!this.mesh)return!1;this.projectPolygon_(),h.computeInterior(this);var f=this.mesh;return b==p.BOUNDARY_CONTOURS?this.setWindingNumber_(f,1,!0):this.tessellateInterior_(f),f.check(),b==p.BOUNDARY_CONTOURS?this.outputContours_(f,d):this.outputPolymesh_(f,b,c,d),!0}}},{}]},{},[1])(1)});
